<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
<title>Secret service CL API
</title>
<link type='text/css' href='style.css' rel='stylesheet'>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width">
   <script src="jquery.min.js"></script>
<script src="toc.min.js"></script>
<script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       tex2jax: {
         inlineMath: [['$','$']],
         processEscapes: true
       }
     });
   </script>
   <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
   </script>
   
</head>
<body>
<div id="content-container">
<div id="toc">
<div id="page-toc">
</div>
<div id="toc-footer"><ul><li><a href="https://github.com/melisgl/mgl-pax">[generated by MGL-PAX]</a></li></ul></div>
</div>
<div id="content">
<p><a id="x-28SECRET-SERVICE-3A-40INDEX-20MGL-PAX-3ASECTION-29"></a>
<a id="SECRET-SERVICE:@INDEX%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#SECRET-SERVICE:@FIND%20MGL-PAX:SECTION" title="Find secrets">&#8594;</a> <a href="index.html" title="Secret service CL API">&#8634;</a></span></span></p>

<h1><a href="index.html">Secret service CL API</a></h1>

<h2>Table of Contents</h2>

<ul>
<li><a href="#SECRET-SERVICE:@FIND%20MGL-PAX:SECTION" title="Find secrets">1 Find secrets</a></li>
<li><a href="#SECRET-SERVICE:@MANAGE%20MGL-PAX:SECTION" title="Manage secrets">2 Manage secrets</a></li>
<li><a href="#SECRET-SERVICE:@COLLECTIONS%20MGL-PAX:SECTION" title="Collections">3 Collections</a></li>
</ul>

<h6>[in package SECRET-SERVICE]</h6>

<p>This is a partial interface to the <a href="https://specifications.freedesktop.org/secret-service/latest/index.html" >Secret Service API</a> in Common Lisp. Secret
service is an API to store keys and passwords in a dedicated service; both Gnome
and KDE provide such service (gnome-keyring).</p>

<p>It allows one to offload caring about how to safely store passwords and keys for
CL projects to someone else.</p>

<p>Simple usage:</p>

<pre><code><span class="code">  <span class="paren1">(<span class="code">find-the-secret '<span class="paren2">(<span class="code"><span class="paren3">(<span class="code"><span class="string">"machine"</span> <span class="string">"example.com"</span></span>)</span></span>)</span></span>)</span></span></code></pre>

<p>would return password for the secret with parameter machine having provided value,
 if there is only one, prompting for password if necessary.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">create-item <span class="paren2">(<span class="code"><i><span class="symbol">default-collection</span></i></span>)</span> <span class="string">"My shop"</span> nil <span class="string">"password"</span></span>)</span>
=&gt; "/org/freedesktop/secrets/collection/login/148"
=&gt; "/"</span></code></pre>

<p>would create an item with just a label and a secret and return the path to it;
note that there is no property there that can be used to find the item by
search, but it shows (e.g., in Seahorse or emacs) properly.</p>

<pre><code><span class="code"><span class="paren1">(<span class="code">get-secret-of-item *</span>)</span>
=&gt; "password"</span></code></pre>

<p>would again reveal the password.</p>

<p><a id="x-28SECRET-SERVICE-3A-40FIND-20MGL-PAX-3ASECTION-29"></a>
<a id="SECRET-SERVICE:@FIND%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="index.html" title="Secret service CL API">&#8592;</a> <a href="index.html" title="Secret service CL API">&#8593;</a> <a href="#SECRET-SERVICE:@MANAGE%20MGL-PAX:SECTION" title="Manage secrets">&#8594;</a> <a href="#SECRET-SERVICE:@FIND%20MGL-PAX:SECTION" title="Find secrets">&#8634;</a></span></span></p>

<h2><a href="#SECRET-SERVICE:@FIND%20MGL-PAX:SECTION">1 Find secrets</a></h2>

<p><a id="x-28SECRET-SERVICE-3AFIND-ALL-SECRETS-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:FIND-ALL-SECRETS%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:FIND-ALL-SECRETS%20FUNCTION" >FIND-ALL-SECRETS</a></span></span> <span class="locative-args">PARS</span></span></p>

<p>Find all secrets with attributes in <code>PARS</code>.  Returns a list of
match pairs (path secret). See secret structure for the second item format.</p>

<p>E.g.,
<code>
(find-all-secrets '((&quot;machine&quot; &quot;example.com&quot;)))
</code></p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AGET-SECRET-OF-ITEM-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:GET-SECRET-OF-ITEM%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:GET-SECRET-OF-ITEM%20FUNCTION" >GET-SECRET-OF-ITEM</a></span></span> <span class="locative-args">PATH</span></span></p>

<p>Get secret from secret item on <code>PATH</code>.</p>

<p>Provide restart that tries to unlock and read again. This should not be standard
situation, but, as API standard says, The inherent race conditions present due
to this are unavoidable, and must be handled gracefully.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3ASTRINGIFY-SECRET-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:STRINGIFY-SECRET%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:STRINGIFY-SECRET%20FUNCTION" >STRINGIFY-SECRET</a></span></span> <span class="locative-args">SECRET</span></span></p>

<p>Turn secret structure returned by D-Bus to a secret string</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AGET-SECRET-ITEM-ATTRIBUTES-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:GET-SECRET-ITEM-ATTRIBUTES%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:GET-SECRET-ITEM-ATTRIBUTES%20FUNCTION" >GET-SECRET-ITEM-ATTRIBUTES</a></span></span> <span class="locative-args">ITEM-PATH</span></span></p>

<p>An alist of all item attributes. The cars of each item is a keyword.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AGET-SECRET-ITEM-ATTRIBUTE-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:GET-SECRET-ITEM-ATTRIBUTE%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:GET-SECRET-ITEM-ATTRIBUTE%20FUNCTION" >GET-SECRET-ITEM-ATTRIBUTE</a></span></span> <span class="locative-args">ITEM LABEL</span></span></p>

<p>Get attribute of a secret item</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AGET-SECRET-ITEM-PROPERTY-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:GET-SECRET-ITEM-PROPERTY%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:GET-SECRET-ITEM-PROPERTY%20FUNCTION" >GET-SECRET-ITEM-PROPERTY</a></span></span> <span class="locative-args">ITEM-PATH LABEL</span></span></p>

<p>Get attribute <code>LABEL</code> of secret item with path <code>ITEM-PATH</code>.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3ASECRET-ITEM-SEARCH-ERROR-20CONDITION-29"></a>
<a id="SECRET-SERVICE:SECRET-ITEM-SEARCH-ERROR%20CONDITION"></a></p>

<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type">[condition]</span> <span class="reference-object"><a href="#SECRET-SERVICE:SECRET-ITEM-SEARCH-ERROR%20CONDITION" >SECRET-ITEM-SEARCH-ERROR</a></span></span> <span class="locative-args"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_error.htm" title="ERROR (MGL-PAX:CLHS CONDITION)">ERROR</a></span></span></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AFIND-THE-SECRET-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:FIND-THE-SECRET%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:FIND-THE-SECRET%20FUNCTION" >FIND-THE-SECRET</a></span></span> <span class="locative-args">PARS</span></span></p>

<p>Make sure that there is just one secret matching pars, and return it.
Raise error otherwise, or when the secret needs to be unlocked.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3A-40MANAGE-20MGL-PAX-3ASECTION-29"></a>
<a id="SECRET-SERVICE:@MANAGE%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#SECRET-SERVICE:@FIND%20MGL-PAX:SECTION" title="Find secrets">&#8592;</a> <a href="index.html" title="Secret service CL API">&#8593;</a> <a href="#SECRET-SERVICE:@COLLECTIONS%20MGL-PAX:SECTION" title="Collections">&#8594;</a> <a href="#SECRET-SERVICE:@MANAGE%20MGL-PAX:SECTION" title="Manage secrets">&#8634;</a></span></span></p>

<h2><a href="#SECRET-SERVICE:@MANAGE%20MGL-PAX:SECTION">2 Manage secrets</a></h2>

<p><a id="x-28SECRET-SERVICE-3ACREATE-ITEM-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:CREATE-ITEM%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:CREATE-ITEM%20FUNCTION" >CREATE-ITEM</a></span></span> <span class="locative-args">COLLECTION-PATH LABEL DICT SECRET &amp;KEY REPLACE (CONTENT-TYPE &quot;text/plain&quot;)</span></span></p>

<p>Create an item.</p>

<p>Collection-path is a path to the <a href="#SECRET-SERVICE:COLLECTION%20MGL-PAX:GLOSSARY-TERM" title="SECRET-SERVICE:COLLECTION MGL-PAX:GLOSSARY-TERM"><code>COLLECTION</code></a> that should store the secret <code>LABEL</code> is name of the secret, <code>DICT</code> alist of attributes (all atoms strings), and <code>SECRET</code> the secret to store.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3ADELETE-SECRET-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:DELETE-SECRET%20FUNCTION"></a></p>

<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:DELETE-SECRET%20FUNCTION" >DELETE-SECRET</a></span></span> <span class="locative-args">PATH</span></span></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3A-40COLLECTIONS-20MGL-PAX-3ASECTION-29"></a>
<a id="SECRET-SERVICE:@COLLECTIONS%20MGL-PAX:SECTION"></a></p>

<p><span class="outer-navigation"><span class="navigation"> <a href="#SECRET-SERVICE:@MANAGE%20MGL-PAX:SECTION" title="Manage secrets">&#8592;</a> <a href="index.html" title="Secret service CL API">&#8593;</a> <a href="#SECRET-SERVICE:@COLLECTIONS%20MGL-PAX:SECTION" title="Collections">&#8634;</a></span></span></p>

<h2><a href="#SECRET-SERVICE:@COLLECTIONS%20MGL-PAX:SECTION">3 Collections</a></h2>

<p><a id="x-28SECRET-SERVICE-3ACOLLECTION-20MGL-PAX-3AGLOSSARY-TERM-29"></a>
<a id="SECRET-SERVICE:COLLECTION%20MGL-PAX:GLOSSARY-TERM"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[glossary-term]</span> <span class="reference-object"><a href="#SECRET-SERVICE:COLLECTION%20MGL-PAX:GLOSSARY-TERM" >COLLECTION</a></span></span></span></p>

<p><a href="https://specifications.freedesktop.org/secret-service/latest/ch03.html" >Collection</a> is a group of secret service items (keyring, wallet). Each secret is part of a collection.</p>

<p>They are identified by the path. There are two commonly used collections - session and login.</p>

<p>Collection can be accessed by an alias. Alias DEFAULT should be always present.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3ADEFAULT-COLLECTION-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:DEFAULT-COLLECTION%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:DEFAULT-COLLECTION%20FUNCTION" >DEFAULT-COLLECTION</a></span></span></span></p>

<p>Default collection, that is, collection with alias default.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3A-2ALOGIN-COLLECTION-2A-20VARIABLE-29"></a>
<a id="SECRET-SERVICE:*LOGIN-COLLECTION*%20VARIABLE"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[variable]</span> <span class="reference-object"><a href="#SECRET-SERVICE:*LOGIN-COLLECTION*%20VARIABLE" >*LOGIN-COLLECTION*</a></span></span> <span class="locative-args">&quot;/org/freedesktop/secrets/collection/login&quot;</span></span></p>

<p>Path to the collection named login. This is a commonly used collection.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3A-2ASESSION-COLLECTION-2A-20VARIABLE-29"></a>
<a id="SECRET-SERVICE:*SESSION-COLLECTION*%20VARIABLE"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[variable]</span> <span class="reference-object"><a href="#SECRET-SERVICE:*SESSION-COLLECTION*%20VARIABLE" >*SESSION-COLLECTION*</a></span></span> <span class="locative-args">&quot;/org/freedesktop/secrets/collection/session&quot;</span></span></p>

<p>Path to the collection named session. Gnome keyring provides this collection; it has lifetime of the logged in user session.</p>

<p>It may or may not exist with other Service Providers.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AGET-COLLECTIONS-LIST-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:GET-COLLECTIONS-LIST%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:GET-COLLECTIONS-LIST%20FUNCTION" >GET-COLLECTIONS-LIST</a></span></span></span></p>

<p>List of available collections.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AFIND-COLLECTION-BY-NAME-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:FIND-COLLECTION-BY-NAME%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:FIND-COLLECTION-BY-NAME%20FUNCTION" >FIND-COLLECTION-BY-NAME</a></span></span> <span class="locative-args">NAME</span></span></p>

<p>Find path to collection with label or alias <code>NAME</code>.</p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AGET-COLLECTION-BY-ALIAS-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:GET-COLLECTION-BY-ALIAS%20FUNCTION"></a></p>

<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:GET-COLLECTION-BY-ALIAS%20FUNCTION" >GET-COLLECTION-BY-ALIAS</a></span></span> <span class="locative-args">NAME</span></span></p>

<p>Get collection path by alias name, or nil. There is one predefined alias, &quot;session&quot;. </p></li>
</ul>

<p><a id="x-28SECRET-SERVICE-3AGET-COLLECTION-ATTRIBUTES-20FUNCTION-29"></a>
<a id="SECRET-SERVICE:GET-COLLECTION-ATTRIBUTES%20FUNCTION"></a></p>

<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type">[function]</span> <span class="reference-object"><a href="#SECRET-SERVICE:GET-COLLECTION-ATTRIBUTES%20FUNCTION" >GET-COLLECTION-ATTRIBUTES</a></span></span> <span class="locative-args">COLLECTION-PATH</span></span></li>
</ul>
  </div>
</div>
<script>$('#page-toc').toc({'selectors': 'h1,h2,h3,h4'});</script>
</body>
</html>
